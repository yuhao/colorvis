<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.88.1">
    <title>Exploring Camera Color Space</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/headers/">

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">


    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>

    
    <!-- Custom styles for this template -->
    <link href="headers.css" rel="stylesheet">

    <!-- JavaScript -->
    <script src='https://cdn.plot.ly/plotly-2.4.2.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.2.1/math.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.0.2/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/1.1.1/chartjs-plugin-zoom.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [ ['$$','$$'], ['\[','\]'] ]
          }
        });
        MathJax.Hub.Register.StartupHook("End",function () {
          console.log("Mathjax loaded");
          console.log(typeof MathJax);
          MathJax.Hub.Queue(["Typeset", MathJax.Hub, "TFS"]);
        });
    </script>
  </head>
  <body>

<main>
  <div class="container">
    <header class="d-flex flex-wrap justify-content-center pt-3 mb-4 border-bottom">
      <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
        <h2>Tutorial 2: Exploring Camera Color Space and Color Correction</h2>
      </a>
    </header>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Introduction</h3>
        <p>Do cameras see the same color as us? Can cameras always accurately reproduce colors that our eyes see? This interactive tutorial explores these questions and many more interesting aspects of camera raw color space. In particular, we will walk you through an important concept in both color science and camera signal processing: color correction, the process of correcting the color perception of a camera such that it is as close to ours as allowed. In the end, you will get to appreciate why you should never trust the color produced by your camera and how you might build your own camera that, in theory, out-performs existing cameras in color reproduction.</p>
        <p><b>Caveats</b>. 1) This tutorial demonstrates the principle of color correction with many important, but subtle, engineering details omitted; we will mention when appropriate. 2) Color correction is one of the two components in camera color reproduction, the other being white balance (or rather, camera's emulation of chromatic adaption of human visual system). <a href="http://yuhaozhu.com/blog/chromatic-adaptation.html">This post</a> discusses the principles of chromatic adaptation and its application in white balance. The relationship of color correction and white balance is quite tricky. Andrew Rowlands has a <a href="https://www.spiedigitallibrary.org/journals/optical-engineering/volume-59/issue-11/110801/Color-conversion-matrices-in-digital-cameras-a-tutorial/10.1117/1.OE.59.11.110801.full?SSO=1">fascinating article</a> that has everything you need to know about color correction and white balance.</p>
      </div>
    </div>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Step 1: Exploring Camera Color Space</h3>
        <p>In principle, cameras work just like our eyes. Our retina has three types of cones (L, M, and S), each with a unique spectral sensitivity, translating light into three numbers (the L, M, S cone responses) that give us color perception. Similar to the three cone types, (most) cameras use three color filters (hereinafter referred to as the R, G, and B filters), each with a unique spectral sensitivity and, thus, also translate light into three numbers. Not all cameras use three filters though. Telescope imaging cameras use <a href="https://www.sdss.org/instruments/camera/">five filters</a>, just like <a href="https://phys.org/news/2013-09-mantis-shrimp-world-eyesbut.html">butterflies</a>!</p>
        <p>The left chart below shows the camera sensitivity functions of <a href="https://www.gujinwei.org/research/camspec/">28 digital cameras</a> measured in the lab using a spectrometer and a monochrometer. The sensitivities are normalized such that the green filter (usually the most sensitive one) peaks at 1. The default view shows the average sensitivities across the 28 cameras, but you can also select a particular camera from the drop-down list. As a comparison, we also plot the LMS cone fundamentals in the same chart as dashed lines. As is customary, the LMS cone fundamentals are, each, normalized to peak at 1. As is usually the case in color science, these normalizations merely introduce some scaling factors that will be canceled out later if we care about just the chromaticity of a color (i.e., the relative ratio of the primaries). What should be noted is that the sensitivities functions measured here are not just the spectral transmittances of the color filters; rather, they are measured by treating the camera as a black box, and thus reflect the combined effects of everything in the camera that has a spectral response to light, such as the anti-aliasing filter, IR filter, micro-lenses, the photosites, etc.</p>
      </div>

      <div class="row">
        <div class="col-sm-7">
          <select id="camSel" style="width: 150px" class="my-2">
          </select>
          <canvas id="canvasCamSpace" class="mt-4"></canvas>
        </div>
        <div class="col-sm-5">
          <div id="locusDiv"></div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-7">
          <div><button id="resetChartCam" disabled>Draw Reset</button> Reset the camera sensitivity chart.</div>
          <div class="my-2"><button id="resetZoomCamSpece">Reset Zoom</button> Reset the zoom of the chart.</div>
        </div>
        <div class="col-sm-5">
          <div><button id="correctLocus" disabled>Corrected XYZ Locus</button> Draw the transformed spectral locus using the color correction matrix.</div>
        </div>
      </div>

      <div class="row">
        <p>You can see that the shapes of the camera sensitivities functions more or less resemble those of the cone fundamentals, which is perhaps not all that surprising. After all, cameras are built to reproduce colors that our eyes see. The shapes, however, are not an exact match. Most notably, you will see that the L and M cone responses overlap much more than the overlap between the R and the G filters. As you can imagine, sensitivities that are overly close to each other won't provide a great ability to distinguish colors. In the extreme case where two filters' sensitivities exactly match, the camera is dichromatic.</p>
        <!-- The camera sensitivities functions rarely exactly mimic the LMS cone responses; they are limited by the optical and silicon materials, the fabrication process, and have to consider not only color reproduction but also the signal-to-noise ratio. -->
        <p>Although by default disabled, the chart also contains the CIE 1931 XYZ Color Matching Functions (CMFs). You can enable them by clicking on the legend to the left of the chart. In fact, clicking on a legend label toggles the visibility of the corresponding curve in the chart. The XYZ CMFs are just one linear transformation away from the LMS cone fundamentals, and is used as the "common language" in colorimetry when comparing different color spaces. So we will use XYZ as the connection color space in the rest of the tutorial. But as you know by now, the XYZ color space and the LMS color space are just one linear transformation away from each other.</p>
        <p>In the same way we can plot the spectral locus in the XYZ color space, we can also plot the spectral locus on a camera's native RGB color space. The 3D plot on the right shows you the spectral locus on the XYZ, LMS, and the camera's RGB color space. The LMS locus is by default disabled, but you can enable it by clicking its legend label. Drag your mouse and spin around the 3D plot. You can see that the spectral locus in XYZ and in camera's RGB space do not match.</p>
        <p>If the three RGB numbers are just one linear transformation away from the three LMS numbers, the camera can essentially see the same colors as us. Otherwise, metamers to our eyes are not metamers to camera. In general, if the camera raw color space is precisely a linear transformation away from LMS/XYZ/other known colorimetric color space, then the camera is said to satisfy the <a href="https://en.wikipedia.org/wiki/Tristimulus_colorimeter#:~:text=A%20camera%20or%20colorimeter%20is,of%20the%20filters%20is%20a">Luther Condition</a>and that the camera space is colorimetric (in that we can use the camera to measure color)</p>
      </div>
    </div>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Step 2: The Correction Targets</h3>
      </div>

      <div class="row">
        <canvas id="canvasCCSpec"></canvas>
        <div class="my-4"><button id="resetZoomSpecR">Reset Zoom</button> Reset the zoom of the chart.</div>
      </div>

    </div>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Step 3: Pick Illuminant</h3>
      </div>

      <div class="row pt-2">
        <div class="col-sm-7">
          <select id="whiteSel" style="width: 150px" class="my-2">
          </select>
          <canvas id="canvasWhite"></canvas>
          <div class="mt-4"><button id="resetWhite" disabled>Reset Illuminant</button> Reset the Illuminant drawing.</div>
          <div class="my-2"><button id="resetZoomWhite">Reset Zoom</button> Reset the zoom of the chart.</div>
        </div>
        <div class="col-sm-5">
        </div>
      </div>
    </div>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Step 5: Calculate Color Correction Matrix</h3>
      </div>

      <div class="row pt-2">
        <div class="col-sm-6">
          <div id="targetDiv"></div>
          <div class="mt-4"><button id="plotTargets">Plot patches</button> Plot the ColorChecker patches in both the XYZ and the camera-native RGB spaces.</div>
        </div>
        <div class="col-sm-6">
          <div><button id="calcMatrix" disabled>Calculate Matrix</button> Calculate the color correction matrix.</div> Do not satisfy the <a href="https://en.wikipedia.org/wiki/Tristimulus_colorimeter#:~:text=A%20camera%20or%20colorimeter%20is,of%20the%20filters%20is%20a">Luther Condition</a>, meaning the camera can't be used for measuring color.
        </div>
      </div>
    </div>

    <div class="b-example-divider"></div>
  </div>


</main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>

    <script src="cam.js"></script>
  </body>
</html>
