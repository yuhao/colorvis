<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.88.1">
    <title>Chromaticity and Gamut</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/headers/">

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">


    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>

    
    <!-- Custom styles for this template -->
    <link href="headers.css" rel="stylesheet">

    <!-- JavaScript -->
    <script src='https://cdn.plot.ly/plotly-2.4.2.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.2.1/math.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.0.2/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/1.1.1/chartjs-plugin-zoom.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
    <script src='hull.js'></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.js"></script>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [ ['$$','$$'], ['\[','\]'] ]
          }
        });
        MathJax.Hub.Register.StartupHook("End",function () {
          console.log("Mathjax loaded");
          console.log(typeof MathJax);
          MathJax.Hub.Queue(["Typeset", MathJax.Hub, "TFS"]);
        });
    </script>
  </head>
  <body>

<main>
  <div class="container">
    <header class="d-flex flex-wrap justify-content-center pt-3 mb-4 border-bottom">
      <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
        <h2>Tutorial 2: Chromaticity, Gamut, and the Scary World of Imaginary Colors</h2>
      </a>
    </header>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Introduction</h3>
        <p>In the previous tutorial, we built a color space by specifying the primary lights and the reference white. The significance of a color space is that it allows us to precisely describe a color as three values (e.g., RGB). However, the RGB values are not quite intuitive to human. For instance, if increase R by 20, G by 30, and decrease B by 24, how is the color changed? Will it become brighter? Will it look like a different color? To answer these questions, we want to decouple the inherent attribute of a color from its intensity, which gives rise to the notion of <i>chromaticity</i>. This is one of the core underlying ideas behind many perceptual color spaces such as <a href="https://en.wikipedia.org/wiki/HSL_and_HSV">HSV/HSB/HSL</a>, <a href="https://en.wikipedia.org/wiki/Munsell_color_system">Munsell Color System</a>, and <a href="https://en.wikipedia.org/wiki/CIELAB_color_space">CIELAB</a> (although they use different mathematical formulations than what's presented here).</p>
        <p>The notion of chromaticity is inherent to color, so it exists in any color space. We will focus ourselves on RGB-like color spaces. The idea we describe here will help you understand other color spaces such as HSV and CIELAB. Better yet, using RGB chromaticity we can gain lots of intuitions about the fundamental attributes of color, color space, and human color perception. This tutorial first introduces the idea of chromaticity, discusses how chromaticity could be derived from a RGB space, and explores some important uses of chromaticity.</p>
      </div>
    </div>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Step 0: Picking a Color Space</h3>
        <p>To be concrete, you will need a specific RGB color space for this tutorial. We invite you to build your own and use it to drive the rest of the tutorial. We know that a color space is uniquely defined by its primaries and the reference white. For simplicity, we will assume CIE Standard Illuminant E (Equal-Energy White) as the reference white, and provide you five ways to pick the primaries.</p>
        <span><b>Spectral primaries:</b></span>
        <ul style="list-style-type:none;">
          <li><input type="radio" value="usePreset1" name="prim"><label for="usePreset1">&nbsp;&nbsp;<b>Use Preset 1</b></label>: spectral lights $445~nm$, $540~nm$, and $590~nm$. This will build a color space that allows us to have an intuitive geometric interpretation of color space.</li>
          <li><input type="radio" value="usePreset2" name="prim"><label for="usePreset2">&nbsp;&nbsp;<b>Use Preset 2</b></label>: spectral lights $415~nm$, $500~nm$, and $540~nm$. Use this option if you want to explore a counter-intuitive color space (see Step 2.4).</li>
          <li><input type="radio" value="selPrim" name="prim"><label for="selPrim">&nbsp;&nbsp;<b>Select Spectral Primaries</b></label>. This will allow you to select three spectral lights as the primaries, exactly like what you did in the previous tutorial.</li>
        </ul>
        <span><b>Non-Spectral primaries:</b></span>
        <ul style="list-style-type:none;">
          <li><input type="radio" value="usePreset3" name="prim"><label for="usePreset3">&nbsp;&nbsp;<b>Use Preset 3</b></label>: primaries are physically-unrealizable lights, each exclusively stimulating only the L, M, and S cone, respectively. This constructs the LMS color space.</li>
          <li><input type="radio" value="drawPrim" name="prim"><label for="drawPrim">&nbsp;&nbsp;<b>Draw Primaries</b></label>. You can draw the spectral power distribution (SPD) of the primaries in the right chart below. You can <button id="resetPrim" class="btn btn-primary btn-sm" disabled>Reset Draw</button> to start over.</li>
        </ul>
      </div>

      <div class="row">
        <div class="col-sm-6">
          <canvas id="canvasLMS"></canvas>
        </div>
        <div class="col-sm-6">
          <canvas id="canvasRGBPrim"></canvas>
        </div>
      </div>
      <p>Once the primaries are picked, we can <button id="plotLocus" class="btn btn-primary btn-sm" disabled>Generate Color Space</button>, which will affect the rest of the tutorial. If you want to use a different color space, simply make the change and click the button again. The color space is built, under the hood, by calculating the Color Matching Functions (CMFs) using the method we explored in the previous tutorial.</p>
    </div>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Step 1: Decoupling Quality (Chromaticity) and Quantity (Brightness)</h3>
        <p>The plot below is the spectral locus in your RGB space. Hover over any point on the locus to reveal the coordinates of the corresponding spectral light. Recall what the coordinates mean: they represent the amount of primaries needed to match the color of that spectral light. In fact, any point in this space corresponds to a color, and the coordinates of the point represent the amount of primaries needed to match that color.</p>
      </div>

      <div class="row">
        <div class="col-sm-4 d-flex align-self-center">
          <div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" role="switch" id="showChrmLine" disabled>
              <label class="form-check-label" for="showChrmLine"><b>Show Equi-Ratio Lines</b></label>
              <p>Show the equi-rgb-ratio lines. All the points along the same line have the same R:G:B ratio.</p>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" role="switch" id="showChrm" disabled>
              <label class="form-check-label" for="showChrm"><b>Show Locus in Chromaticity</b></label>
              <p>Show the chromacitities of the spectral lights.</p>
            </div>
            <div class="form-check form-switch align-self-center">
              <input class="form-check-input" type="checkbox" role="switch" id="showPlane" disabled>
              <label class="form-check-label" for="showPlane"><b>Show R+G+B=1 Plane</b></label>
              <p>The chromaticities of all colors lie on this plane.</p>
            </div>
            <div class="form-check form-switch align-self-center">
              <input class="form-check-input" type="checkbox" role="switch" id="projChrm" disabled>
              <label class="form-check-label" for="projChrm"><b>Project</b></label>
              <p>Project the 3D plot to the r-g plane.</p>
            </div>
          </div>
        </div>
        <div class="col-sm-8">
          <div id="rgbLocusDiv" class="mb-4"></div>
        </div>
      </div>

      <div class="row">
        <p>Now toggle the "Show Equi-Ratio Lines" switch. You will see a set of lines, each of which starts from the origin and goes through a spectral light. By simple geometry, we know that points on a line, while requiring different absolute amounts of RGB primaries (different coordinates in the RGB space), all have the same R:G:B ratio. This conclusion generalizes too any line, not just the lines that go through the locus.</p>
        <p>How do a color that's mixed from 1:2:4 units of RGB primaries and a color that's mixed from a 2:4:8 units of the primaries relate? Well, recall from the <a href="cone2cmf.html">previous tutorial</a> that the amount of a primary is directly proportional to the power of that primary. So the second color can be obtained by doubling the power of each primary in the first color; similarly, halving the power of each primary in the second color gets us the first color. Intuitively, lights that have the same primary quantity ratio are said to have the same "objective color quality" while differing in the intensity.</p>
        <p>More formally, we can calculate the primary ratio $r:g:b$ of a color and then normalize the ratio such that $r+g+b = 1$ (100%). The so-calculated $r, g, b$ values of a color are called the <b>chromaticities</b> of that color. Mathematically, the chromaticities of a color are calculated from its absolute quantity by:</p>
        <p>$r = \frac{R}{R+G+B},~~~g = \frac{G}{R+G+B},~~~b = \frac{B}{R+G+B}$.</p>
        <p>Each color now has an rgb triplet, representing the color's chromaticities. Similar to how we represent colors in the RGB space, we can also plot the colors using their chromaticities. Toggle the "Show Locus in Chromaticity" switch to reveal the spectral locus in chromaticity. Hover over a chromaticity point and the corresponding RGB point on the same line; check the primary ratio in the tooltips and you can see that the primary ratio doesn't change when you plot a color using its chromacitity.</p>
        <p><b>Why Chromaticity?</b> Knowing the chromaticity of a color tells us the <b>inherent attribute</b> of the color, and we can make that color brighter or darker by increasing or decreasing the amount of the primaries <i>while keeping the chromaticity constant</i>. In many practical color applications such as color photography and digital displays, chromaticities of a color is what we strive to capture (in the case of photography) or reproduce (in the case of display), and we are almost never be able to capture/reproduce the exact intensity of light in the scene (think about the power of the sun!).</p>
        <p><b>Chromaticity Diagram.</b> Spin around the plot. Notice how all the spectral lights are now on the same plane. That's the natural implication of how chromaticities are defined: since we enforce $R+G+B=1$, all colors' chromaticities naturally lie on the $R+G+B=1$ plane. Toggle the "Show R+G+B=1 Plane" switch to convince yourself of that. If we were to define chromaticity such that $R+G+B=1.5$, all the colors will then lie on that plane. One way to think of chromaticities is that we shoot rays from the origin to go through all the spectral lights, and then intersect all those lines using the $R+G+B=1$ plane. Geometrically, this is equivalent to a <a href="https://en.wikipedia.org/wiki/3D_projection#Perspective_projection">perspective projection</a> of the RGB colors onto the $R+G+B=1$ plane with the origin as the point of projection.</p>
        <p>Since the chromaticities of all colors lie on one plane, we can represent them in a 2D plot. The convention is to project the $R+G+B=1$ plane onto the r-g plane, and the resulting plot is called the <i>rg-chromaciticy plot</i>. You should try to spin the 3D plot around to project yourself, and you can also toggle the "Project" switch, which does the projection for you.</p>
        <p><b>Chromaticity in Other Color Spaces.</b>This way of calculating chromaticity applies to any RGB color space (or any color space that's a linear transformation away from it, e.g., CIE XYZ, LMS). In some sense, color chromaticity is implicit in these color spaces. There are other color spaces where chromaticity is an explicit part of how a color is described. For instance, HSV/HSB/HSL color spaces describe a color using three numbers: hue, saturation, and value (brightness, lightness). Hue and saturation are two explicit descriptions of a color's chromaticity and have <a href="https://en.wikipedia.org/wiki/HSL_and_HSV">intuition interpretations</a> than r, g, or b. CIELAB provides a perceptually more uniform way of describing chromaticity.</p>
      </div>
    </div>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Step 2: Color Gamut</h3>
      </div>

      <div class="row">
        <p>The chromaticity plot is useful in helping us understand the limit of human visual system (HVS) and the limit of a particular color space: what are all the colors that human can see, and can a color space produce all the colors that human can see? To answer these questions, one could construct every single real light one by one and find its color. While we can't really do that in practice, constructing a few lights that way would help us build the intuition.</p>
        <div class="col-sm-4 d-flex align-self-center mt-4">
          <div>
            <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
              <input type="radio" class="btn-check" name="pick" id="pick0" autocomplete="off" checked disabled>
              <label class="btn btn-outline-primary btn-sm" for="pick0">Clear Pick</label>
            
              <input type="radio" class="btn-check" name="pick" id="pick2" autocomplete="off" disabled>
              <label class="btn btn-outline-primary btn-sm" for="pick2">Pick 2 Colors</label>
            
              <input type="radio" class="btn-check" name="pick" id="pick3" autocomplete="off" disabled>
              <label class="btn btn-outline-primary btn-sm" for="pick3">Pick 3 Colors</label>
            
              <input type="radio" class="btn-check" name="pick" id="pick4" autocomplete="off" disabled>
              <label class="btn btn-outline-primary btn-sm" for="pick4">Pick 4 Colors</label>
            </div>
            <div class="form-check form-switch mt-2">
              <input class="form-check-input" type="checkbox" role="switch" id="showPlane1" disabled>
              <label class="form-check-label" for="showPlane1"><b>Show R+G+B=1 Plane</b></label>
            </div>
            <div class="form-check form-switch mt-2">
              <input class="form-check-input" type="checkbox" role="switch" id="showPlane0" disabled>
              <label class="form-check-label" for="showPlane0"><b>Show R+G+B=0 Plane</b></label>
              <p>If spectral lights are all above or all below this plane (e.g., if you use Preset 1), the HVS gamut in chromaticity is bounded by the convex hull of the spectral colors.</p>
            </div>
            <div class="form-check form-switch mt-2">
              <input class="form-check-input" type="checkbox" role="switch" id="showChrm2" disabled>
              <label class="form-check-label" for="showChrm2"><b>Show Locus in Chromaticity</b></label>
            </div>
            <div class="form-check form-switch mt-2">
              <input class="form-check-input" type="checkbox" role="switch" id="showhvs" disabled>
              <label class="form-check-label" for="showhvs"><b>Show HVS Gamut in Chromaticity</b></label>
              <p>Show the human visible gamut in chromaticity. Enabled only if all spectral colors are above or below the R+G+B=0 plane at the same time. Otherwise the HVS gamut in chromaticity is unbounded and hard to visualize.</p>
            </div>
            <div class="form-check form-switch mt-2">
              <input class="form-check-input" type="checkbox" role="switch" id="showhvsRGB" disabled>
              <label class="form-check-label" for="showhvsRGB"><b>Show HVS Gamut Boundary in RGB</b></label>
              <p>Show partial boundary of human visible gamut in the RGB space. The real gamut extends to infinity as one increases the light power. Any point inside the boundary is a real color.</p>
            </div>
            <div>
              <button class="btn btn-primary btn-sm" type="button" id="showex" disabled>Unusual Example</button> Short-cut for using Preset 2 to build a color space followed by picking 2 spectral colors, one above and the other below the R+G+B=0 plane.
            </div>
          </div>
        </div>
        <div class="col-sm-8 mt-4">
          <div id="chrmLocusDiv"></div>
        </div>
      </div>

      <div class="row mt-4">
        <h4>2.1 Building the Intuition</h4>
        <p><b>Mixing Two Lights.</b> 
        We could think of the SPD of a light as the "recipe" of making that light &#8212; by mixing different amount of spectral lights specified in the SPD. Let's start by mixing two lights and see what happens to the resulting color. If you toggle the "Pick 2 Colors" switch, you can click 2 arbitrary points $\mathbf{A}$ and $\mathbf{B}$ along the RGB locus. What you will get is a line segmentation $\overline{\mathbf{AB}}$. Any point on $\overline{\mathbf{AB}}$ represents a color producible by mixing some portion of colors $\mathbf{A}$ and $\mathbf{B}$.
        <button class="btn btn-secondary btn-xs" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">Show Proof</button>
        </p>
        <div class="collapse" id="collapseExample">
          <div class="card card-body">
            <p>Assuming that the two (spectral) lights you picked have a spectrum of $\Phi_1$ and $\Phi_2$, respectively, and their RGB triplets are $[R_1, G_1, B_1]$ and $[R_2, G_2, B_2]$, respectively. From simple <a href="https://en.wikipedia.org/wiki/Convex_combination">convex geometry</a>, we know that any point $\mathbf{T}$ on the line segment between the two points can be expressed as $[R_t, G_t, B_t] = \alpha[R_1, G_1, B_1] + (1-\alpha)[R_2, G_2, B_2], \alpha \in [0, 1]$. We will show that $[R_t, G_t, B_t]$ is a color that can be produced by mixing two lights: $\alpha\Phi_1$ and $(1-\alpha)\Phi_1$. Note that nothing in the proof below relies on $\Phi_1$ and $\Phi_2$ being spectral, and so the conclusion applies to any lights (and two points in the RGB space).</p>
            <p>Based on how RGB triplets are calculated from the CMFs ($\bar{r(\lambda)}, \bar{g(\lambda)}, \bar{b(\lambda)}$), we have:</p>
            <p>
            $R_1 = \sum_{\lambda} \Phi_1(\lambda) \bar{r}(\lambda), G_1 = \sum_{\lambda} \Phi_1(\lambda) \bar{r}(\lambda), B_1 = \sum_{\lambda} \Phi_1(\lambda) \bar{r}(\lambda)\\$
            $R_2 = \sum_{\lambda} \Phi_2(\lambda) \bar{r}(\lambda), G_2 = \sum_{\lambda} \Phi_2(\lambda) \bar{r}(\lambda), B_2 = \sum_{\lambda} \Phi_2(\lambda) \bar{r}(\lambda)$
            </p>
            <p>The RGB triplet of the new light mixed from $\alpha\Phi_1$ and $(1-\alpha)\Phi_1$ is:</p>
            <p>
            $\sum_{\lambda} [\alpha\Phi_1(\lambda) + (1-\alpha)\Phi_2(\lambda)] \bar{r}(\lambda) = \alpha\sum_{\lambda} \Phi_1(\lambda)\bar{r}(\lambda) + (1-\alpha)\sum_{\lambda} \Phi_2(\lambda)\bar{r}(\lambda) = \alpha R_1 + (1-\alpha) R_2 = R_t\\$
            $\sum_{\lambda} [\alpha\Phi_1(\lambda) + (1-\alpha)\Phi_2(\lambda)] \bar{g}(\lambda) = \alpha\sum_{\lambda} \Phi_1(\lambda)\bar{g}(\lambda) + (1-\alpha)\sum_{\lambda} \Phi_2(\lambda)\bar{g}(\lambda) = \alpha G_1 + (1-\alpha) G_2 = G_t\\$
            $\sum_{\lambda} [\alpha\Phi_1(\lambda) + (1-\alpha)\Phi_2(\lambda)] \bar{b}(\lambda) = \alpha\sum_{\lambda} \Phi_1(\lambda)\bar{b}(\lambda) + (1-\alpha)\sum_{\lambda} \Phi_2(\lambda)\bar{b}(\lambda) = \alpha B_1 + (1-\alpha) B_2 = B_t$
            </p>
            <p>Q.E.D.</p>
          </div>
        </div>
        <p>How does the mixed color look like in chromaticity? The line segment $\overline{\mathbf{AB}}$ in the RGB space is mapped to a line segment $\overline{\mathbf{ab}}$ in the chromaticity plane. $\overline{\mathbf{ab}}$ connects two points $\mathbf{a}$ and $\mathbf{b}$, which represent the chromaticity of two spectral colors $\mathbf{A}$ and $\mathbf{B}$, respectively. Meanwhile, a point $\mathbf{T}$ on $\overline{\mathbf{AB}}$ gets mapped to a point $\mathbf{t}$ on the chromaticity plane. $\mathbf{t}$ represents the chromaticity of color $\mathbf{T}$. Where is $\mathbf{t}$? $\mathbf{t}$ will be within $\overline{\mathbf{ab}}$ if $\overrightarrow{\rm \mathbf{OA}}$ and $\overrightarrow{\rm \mathbf{OB}}$ <a href="https://en.wikipedia.org/wiki/Line%E2%80%93plane_intersection">intersect</a> the $R+G+B=1$ plane either both positively or both negatively ($\mathbf{O}$ is the origin). Informally, this requires that $\mathbf{A}$ and $\mathbf{B}$ are both below or both above the $R+G+B=0$ plane. Toggle the "Show R+G+B=0 Plane" and spin the plot to convince yourself.</p>
<div class="card mb-3">
<div class="card-body">
        In general, if the condition is met that <i>all the spectral colors are all above or all below the $R+G+B=0$ plane</i>, there exists a very powerful interpretation of the chromaticity diagram: connect any two points $\mathbf{a}$ and $\mathbf{b}$ in the chromaticity diagram and form a line segment $\overline{\mathbf{ab}}$, points on $\overline{\mathbf{ab}}$ represent the <i>chromaticities</i> of all the colors that can be produced by mixing two colors whose chromaticities are $\mathbf{a}$ and $\mathbf{b}$, respectively.
</div>
</div>
	<p>Visualizations of the spectral locus you can find on the Internet usually in a color space where the primaries are carefully picked such that the condition above is met. The CIE XYZ color space and the LMS cone space meet this condition, too. The primary choice in Preset 1 is one such example. We will assume such a color space for now. In Step 2.4, we will explain what happens when you build a color space that does not meet the above condition.</p>
        <p><b>Mixing Three Lights.</b> The same intuition applies to three colors. Toggle the "Pick 3 Colors" switch, and pick three colors on the RGB spectral locus, which will form a triangle. Any point on that triangle represents a color that is produced from mixing the three chosen spectral lights. That triangle is mapped to another triangle in the chromaticity diagram. In general, if you pick three colors $\mathbf{a}$, $\mathbf{b}$, and $\mathbf{c}$ in the chromaticity diagram, the triangle $\triangle \mathbf{abc}$ contains the chromaticities of all the colors that can be produced from three lights whose chromaticities are $\mathbf{a}$, $\mathbf{b}$, and $\mathbf{c}$, respectively.</p>
        <p><b>Mixing Four Lights. </b>Let's try one more. Toggle the "Pick 4 Colors" switch and pick four colors on the RGB spectral locus. What you get is a tetrahedron. Any point within that tetrahedron represents a color that is produced from mixing the four chosen spectral lights. That tetrahedron is mapped to a quadrilateral in the chromaticity diagram. In general, if you pick four colors $\mathbf{a}$, $\mathbf{b}$, $\mathbf{c}$, and $\mathbf{d}$ in the chromaticity diagram, the quadrilateral $\square \mathbf{abcd}$ contains the chromaticities of all the colors that can be produced from four lights whose chromaticities are $\mathbf{a}$, $\mathbf{b}$, $\mathbf{c}$, and $\mathbf{d}$, respectively.</p>
        <h4>2.2 Color Perception Limit of Human Visual System (HVS)</h4>
        <p><b>Generalization.</b> We can keep playing this game. If a light is made of five spectral lights, its chromaticity will fall in the pentagon formed by the five lights; if a light is made of six spectral lights, its chromaticity will fall in the hexagon formed by the six spectral lights. Essentially, given a light's SPD $\Phi$, we can find its constituting spectral lights, which form a polygon in the chromaticity diagram. The chromaticity of $\Phi$ falls in the polygon.</p>
        <p>If we exhaust all combinations of all wavelengths in the visible spectrum, we will have found all possible colors, which we call the <b>gamut of human color vision</b>. What's the geometric structure of the gamut? Generalizing the intuition we have built so far, it's not difficult to see that the chromaticities of all colors must reside in the <a href="https://en.wikipedia.org/wiki/Convex_hull">convex hull</a> of the spectral locus in the chromaticity diagram. Click the button "Show HVS gamut in Chromaticity" to reveal it. If you choose the Preset 1 primaries, it happens to be the case that the spectral locus itself is a convex set, in which case the gamut is simply the area under the locus.</p>
        <p><b>Gamut is a 3D Concept.</b> Visualizing the gamut of human color vision in chromaticity is nice, but the actual HVS gamut lives in the RGB space and so is a 3D concept. How does HVS gamut look like in RGB? We can't possible visualize it, because you can just keep increasing the power of a light and get infinite amount of colors &#8212; ignore the fact that high-intensity lights destroy retinas for a moment. But we can get a sneak peak of the <i>bounds</i> of HVS gamut in the RGB space. Toggle the "Show HVS Gamut Boundary in RGB" switch. It will show the boundary of the gamut in the RGB space. The actual boundary grows forever by extending what's plotted. Any point within the boundary is a real color, i.e., a part of the human visual gamut.</p>
        <h4>2.3 Gamut of a Color Space</h4>
        <p>Many lights that enter our eyes are not natural lights, but lights from various light-generating devices such as smartphones, computers, and printed paper. Each output device has its own color space, such as sRGB, CMYK, and DCI-P3. All the colors that can be produced by a color space is called the <b>gamut of the color space</b>. Is there a color space that can produce all the colors?</p>
        <p>The answer is no, and we can have a very intuitive explanation. Look at the chromaticity diagram of the color space built using the Preset 1 primaries. No matter what colors and how many colors you choose as primaries to build a color space, the primaries of any color space must reside inside the spectral locus, and all the colors that are producible from that color space must be inside the polygon formed by the primaries. Since the spectral locus is convex, the polygon is guaranteed to be enclosed by the locus. Therefore, the gamut of any color space is guaranteed to be a subset of the color gamut of HVS. In addition, since the polygon is always enclosed by the locus, it's impossible to find a polygon that includes all the spectral colors. That is, no color space can produce all spectral colors.</p>
        <p>These conclusions, however, apply only to color spaces whose primaries are real colors. If a color space, such as CIE XYZ, LMS, and ProPhoto RGB, uses imaginary primaries, its color gamut could include imaginary colors and thus is not a subset of HVS gamut. The color gamut of CIE XYZ completely covers the entire HVS gamut (and by extension all the spectral colors). We will explore imaginary colors in more details in Step 4.</p>
        <h4>2.4 Visualizing a Counter-Intuitive Color Space</h4>
	<p>The primaries in Preset 1 lead to a color space where the spectral colors are all above the $R+G+B=0$ plane. However, that condition is not always met for any arbitrary choice of primaries. Preset 2 is a counter-example. Select that preset and compare the RGB locus points with the $R+G+B=0$ plane. Then pick two colors $\mathbf{A}$ and $\mathbf{B}$, one above and the other below the $R+G+B=0$ plane. You will see that a point on $\overline{\mathbf{AB}}$ won't be mapped to a point on $\overline{\mathbf{ab}}$ after being projected through the origin. We have cooked an example for you. Click "Unusual Example" to see it. In general, when the spectral colors are separated by the $R+G+B=0$ plane, the HVS gamut extends to infinity in the chromaticity <button class="btn btn-secondary btn-xs" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample1" aria-expanded="false" aria-controls="collapseExample">Show Intuition</button>, which becomes hard to visualize. Under that circumstance, we disable the "Show HVS Gamut in Chromaticity" button.</p>
        <div class="collapse" id="collapseExample1">
          <div class="card card-body">
            <span>If a spectral color is above $R+G+B=0$ and another is below $R+G+B=0$, then there must be a color that's mixed from these two colors and that lies on the $R+G+B=0$ plane. The chromaticity values of that new color are infinities, since $R+G+B$ is the denominator in calculating the chromaticity.</span>
          </div>
        </div>
        <p>Also try showing the locus in chromaticity; see how weird that locus becomes. This could initially seem odd; how could a nice smooth curve in RGB become so entangled in the rgb space? The reason is that the transformation from RGB to rgb isn't linear (or affine for that matter); it's a perspective transformation.</p>
        <p>Nothing is wrong with a color space where spectral colors are separate by the $R+G+B=0$ plane. It just means we can't use the chromaticity diagram to easily reason about the effect of mixing colors in that color space. For instance, we can't say the HVS gamut in such a color space is the area under the convex hull of the locus. In addition, since the spectral colors do not form a convex set anymore, it's possible to pick three spectral colors such that the resulting triangle in chromaticity contains other spectral colors. It doesn't mean all of a sudden we can build a RGB color space that can produce spectral colors. We didn't (and couldn't) change the fundamental, inherent properties of color, which hold regardless in which color space we represent colors. However, it does mean that the intuitive interpretations of the chromaticity diagram we developed above don't apply to these "usual" color spaces.</p>
      </div>
    </div>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Step 3: Physically-Unrealizable Lights and Imaginary Colors</h3>
        <p>From the visualization above, we can see that the HVS gamut occupies a subset of the entire RGB space. A natural question then is: what about those RGB points that are outside the HVS gamut? What exactly are they? Can we generate colors at those points? It turns out that we can mathematically construct "imaginary colors" whose RGB triplets are outside the HVS gamut &#8212; from physically-unrealizable lights.</p>
        <p><b>Physically-Realizable Lights.</b> Lights whose SPDs are non-negative everywhere are physically-realizable. We can, in theory, generate such lights by collecting photons at different wavelengths as specified by the SPD. The RGB triplet of a physically-realizable light corresponds to a real color. As discussed above, a real color is a part of the gamut of human color perception; in the chromaticity diagram, a real color falls within the area under the locus if the locus is convex, which is the case if you use Preset 1.</p>
        <p>Since photons always have positive energy, a "light" would be physically-unrealizable if its SPD is negative at certain wavelengths. Mathematically, however, nothing prevents us from calculating the RGB triplet of a physically-unrealizable light using the CMFs of a color space. An RGB point would not represent a real color if the RGB triplet can not be produced from <i>any</i> physically-realizable light. We call such a color an <i>imaginary color</i>.</p>
        <p><b>The Math of Imaginary Colors.</b> Given an RGB color space, can you find all the imaginary colors, those that can never be generated from real lights? Intuitively, any point outside the gamut is an imaginary color, but let's reason about this a bit more rigorously. Mathematically stated, given an RGB point $[R_t, G_t, B_t]$ in a color space whose CMFs are $\bar{r}(\lambda), \bar{g}(\lambda), \bar{b}(\lambda)$, we want to know whether the following <i>constrained</i> system of equations have a solution:<p>
        <p>$
          \begin{bmatrix}
          R_t \\
          G_t \\
          B_t
          \end{bmatrix} =
          \begin{bmatrix}
          \bar{r}(380) & \cdots \bar{r}(500) & \cdots & \bar{r}(780) \\
          \bar{g}(380) & \cdots \bar{g}(500) & \cdots & \bar{g}(780) \\
          \bar{b}(380) & \cdots \bar{b}(500) & \cdots & \bar{b}(780)
          \end{bmatrix}
          \times
          \begin{bmatrix}
          \Phi(380) \\
          \cdots \\
          \Phi(500) \\
          \cdots \\
          \Phi(780)
          \end{bmatrix}
          $, $\Phi(\lambda) \ge 0 ~~ \forall \lambda \in [380, 780] $, where $\Phi(\lambda)$ is the SPD to be solved for.
        </p>
        <p>If not, $[R_t, G_t, B_t]$ is an imaginary color. Without the constraint that the SPD is non-negative at every wavelength, this system of equations is under-determined and so has infinitely many solutions. But with the constraint, it's possible that there's no solution.</p>
        <p><b>Finding Imaginary Colors.</b> You can verify this for yourself. Look at the gamut on the right and use your intuition to identify a point that you believe should be an imaginary color. Then put the RGB coordinates of that point in the input boxes below, and hit the "Find SPD" button. One of two things will happen.</p>
        <div>
          <ul>
            <li>If the color is a real color (think harder!), there are many spectra that could have led to that particular RGB triplet; we just plot one such spectrum. You will see that the RGB point falls within the gamut and the chromaticity is within the convex hull of the spectral locus.</li>
            <li>If the color is indeed an imaginary color (great job!), there isn't a real light that could lead to that RGB point, but a physically-unrealizable light could. To convince yourself of this, click the "Find an Unreal Light" button. A light that mathematically gives the target RGB triplet but with negative SPD values is plotted. You will also see that the RGB triplet is outside the gamut and the chromaticity is outside the convex hull of the locus.</li>
          </ul>
        </div>
        <p>You are invited to change the color space, and see how a RGB point that represents a real color in one color space will represent an imaginary color in another color space.</p>
      </div>

      <div class="row">
        <div class="col-sm-5">
          <div class="row">
            <canvas id="canvasSPD"></canvas>
            <div class="input-group input-group-sm mb-1">
              <span class="input-group-text">$R_t$</span>
              <input type="text" id="rt" class="form-control" placeholder="" aria-label="R">
              <span class="input-group-text">$G_t$</span>
              <input type="text" id="gt" class="form-control" placeholder="" aria-label="G">
              <span class="input-group-text">$B_t$</span>
              <input type="text" id="bt" class="form-control" placeholder="" aria-label="B">
              <button class="btn btn-primary btn-sm" type="button" id="findspd" disabled>Find SPD</button>
            </div>
            <div class="input-group input-group-sm mb-3 justify-content-between">
              <span class="input-group-text" id="colTypeSpan" style="border: none; background-color:transparent;"><b id="colortype"></b></span>
              <button class="btn btn-primary btn-sm ml-2" type="button" id="findImgSpd" disabled>Find an Unreal Light</button>
            </div>
          </div>
          <hr>
          <div class="row">
            <canvas id="canvasDrawSPD"></canvas>
            <div class="d-flex">
              <div class="input-group input-group-sm">
                <div class="form-check form-switch mt-1 mx-4">
                  <input class="form-check-input" type="checkbox" role="switch" id="drawSPD" disabled>
                  <label class="form-check-label" for="drawSPD"><b>Draw Light</b></label>
                </div>
                <button id="findColor" class="btn btn-primary btn-sm" disabled>Calculate Color</button>
                <span class="input-group-text" id="colTypeSpan2" style="border: none; background-color:transparent;"><b id="colortype2"></b></span>
              </div>
              <button id="resetSPD" class="ms-auto btn btn-primary btn-sm" disabled>Reset</button>
            </div>
          </div>
        </div>

        <div class="col-sm-7">
          <div id="chrmLocus2Div"></div>
          <div class="btn-toolbar d-flex justify-content-center mt-4" role="toolbar" aria-label="Toolbar with button groups">
            <div class="form-check form-switch mx-2">
              <input class="form-check-input" type="checkbox" role="switch" id="showhvs2" disabled>
              <label class="form-check-label" for="showhvs2"><b>Show HVS Gamut in Chromaticity</b></label>
            </div>
            <div class="form-check form-switch mx-2">
              <input class="form-check-input" type="checkbox" role="switch" id="showhvsRGB2" disabled>
              <label class="form-check-label" for="showhvsRGB2"><b>Show HVS Gamut Boundary in RGB</b></label>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <p><b>LMS is a Color Space with Imaginary Primaries.</b> Since a color can be represented as a LMS triplet, we can think of LMS as a color space, too. The CMFs of the LMS space are the cone sensitivity functions. What are the primary lights of the LMS color space? By definition, the primaries of a color space sit on the axes. Therefore, each LMS primary should stimulate exclusively only one cone type. What should these colors look like? Pick Preset 3 in Step 0, which will calculate three lights that exclusively stimulate only one cone type each (there are infinitely many such lights; we plot the ones that generate equal LMS responses at unity). See how they all have negative portion in the SPDs. That is, primaries of the LMS space are physically-unrealizable lights.</p>
        <p>Now you can plot the locus in the LMS space. As you can see, any point on the axes is out of the HVS gamut, showing that the LMS primaries are imaginary colors. This also shows that not all positive LMS combinations can be generated by a physically-realizable light. Note that invisible (but physically realizable) lights such as IR or UV lie on the origin of the LMS space.</p>
        <p><b>Real and Unreal Lights Could Generate the "Same Color".</b> Interestingly but perhaps unsurprisingly, it is possible that a real light and a unreal light are mapped to the same RGB point. This is because the system of equations above is under-determined. It could have two solutions, one meets the non-negative constraints and the other does not. That is, a real light can be a metamer of a unreal light, mathematically!</p>
        <p>To verify that, click the "Draw Light" switch above and draw an SPD. Then click "Calculate color", which will show you whether that SPD corresponds to a real color or an imaginary color. Try intentionally giving some negative power to a light to see if you can generate a real color.</p>
      </div>

    </div>


    <div class="b-example-divider"></div>
  </div>


</main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>

    <script src="chrm.js"></script>
  </body>
</html>
