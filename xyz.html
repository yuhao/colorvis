<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.88.1">
    <title>XYZ Color Space</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/headers/">

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">


    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>

    
    <!-- Custom styles for this template -->
    <link href="headers.css" rel="stylesheet">

    <!-- JavaScript -->
    <script src='https://cdn.plot.ly/plotly-2.4.2.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.2.1/math.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/1.1.1/chartjs-plugin-zoom.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
    <script src='hull.js'></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.js"></script>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [ ['$$','$$'], ['\[','\]'] ]
          }
        });
        MathJax.Hub.Register.StartupHook("End",function () {
          console.log("Mathjax loaded");
          console.log(typeof MathJax);
          MathJax.Hub.Queue(["Typeset", MathJax.Hub, "TFS"]);
        });
    </script>
  </head>
  <body>

<main>
  <div class="container">
    <header class="d-flex flex-wrap justify-content-center pt-3 mb-4 border-bottom">
      <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
        <h2>Tutorial 3: From RGB to XYZ</h2>
      </a>
    </header>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Introduction</h3>
      </div>
    </div>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Part 1: The Intuition</h3>
        <p>We will show what the transformation does and leave the derivation of the transformation to the next part. The left plot shows the spectral locus in the CIE 1931 RGB color space. Spin around the plot and hover the locus you will see that some spectral lights require negative amount of primaries. One goal of the XYZ space is that all spectral colors should have positive primary amounts. In other words, the spectral locus should reside in the all-positive octant of the XYZ space.</p>
        <p>One way to reason about the RGB to XYZ transformation is to choose three vectors originating from the origin in the RGB space ($\overrightarrow{\mathbf{OC_r}}$, $\overrightarrow{\mathbf{OC_g}}$, and $\overrightarrow{\mathbf{OC_b}}$); these vectors should be chosen in such a way that they, after transformation, become the basis vectors in the XYZ space. In the RGB space, the spectral locus should be completely enclosed by the planes formed by the three vectors. Toggle the "Show Bounds" button to reveal the vectors and the bound.</p>

        <div class="row mt-1 mb-4">
          <div class="col-sm-6">
            <div id="spaceDiv"></div>
            <div class="btn-group-sm d-flex justify-content-center" role="group" aria-label="Basic radio toggle button group">
              <div class="form-check form-switch mx-2 mt-1">
                <input class="form-check-input" type="checkbox" role="switch" id="showBounds">
                <label class="form-check-label" for="showBounds"><b>Show Bounds</b></label>
              </div>

              <input type="radio" class="btn-check" name="3dmode" id="showRGB" autocomplete="off" checked>
              <label class="btn btn-outline-primary btn-sm" for="showRGB">RGB</label>

              <input type="radio" class="btn-check" name="3dmode" id="showXYZ" autocomplete="off">
              <label class="btn btn-outline-primary btn-sm" for="showXYZ">XYZ</label>
            </div>
          </div>
          <div class="col-sm-6">
            <div id="chrmDiv"></div>
            <div class="btn-group-sm d-flex justify-content-center" role="group" aria-label="Basic radio toggle button group">
              <input type="radio" class="btn-check" name="2dmode" id="showrg" autocomplete="off" checked>
              <label class="btn btn-outline-primary btn-sm" for="showrg">rg-chromaticity</label>

              <input type="radio" class="btn-check" name="2dmode" id="showxy" autocomplete="off">
              <label class="btn btn-outline-primary btn-sm" for="showxy">xy-chromaticity</label>
            </div>
          </div>
        </div>

        <p>Now click the "XYZ" button. You will see the transformed locus in the XYZ space. The three vectors are now the unit basis vectors in the XYZ space, and the spectral locus is completely within the all-positive octant in the XYZ space.</p>
        <p>Along with the RGB to XYZ transformation, there is also a corresponding rg to xy chromaticity transformation, which we visualize in the plot on the right. Toggle the "xy-chromaticity" button to see the transformation. The chromaticity gamut of the XYZ space is the triangle, which completely encloses the spectral locus. The HVS gamut (in chromaticity) is the area under the spectral locus. Note, however, while RGB-to-XYZ is a linear transformation, rg-to-xy transformation is not. This is because RGB-to-rgb is not a linear transformation, as we discussed in <a href="chromaticity.html">the chromaticity tutorial</a>.</p>

      <div class="row">
        <h4>The xyY Color Space</h4>
        <div id="xyYDiv"></div>
        <p>Sometimes you will also see the notion of "xyY" space. From the an xyz triplet, we can't uniquely go back to a point in the XYZ space. Essentially, the chromaticity diagram loses the intensity information of a color. The xyY space retains the color intensity information, because the Y component, by construction, encodes the luminance information (of spectral colors of equal power).</p>
        <p>The plot above shows the spectral locus in the xyY space. The xy coordinates of a point shows the chromaticity of the color, and the Y coordinate shows the relatively luminance. In one figure, we get both the chromaticity information and the intensity information.</p>
      </div>

      </div>
    </div>

    <div class="d-grid gap-3 pt-3 mb-4 px-4 bg-light border rounded-3">
      <div class="row">
        <h3>Part 2: The Math</h3>
        <p>The actual process of deriving the transformation is a bit messy. Fairman et al. has a <a href="https://silo.tips/download/how-the-cie-1931-color-matching-functions-were-derived-from-wright-guild-data">detailed paper</a> (<a href="https://onlinelibrary.wiley.com/doi/10.1002/%28SICI%291520-6378%28199808%2923%3A4%3C259%3A%3AAID-COL18%3E3.0.CO%3B2-7">erratum</a>) describing the intricacies of the derivation with many interesting historical notes that are definitely worth reading. We will simplify a few minor details and present the main steps in deriving the transformation matrix.</p>
        <p>The goal is to obtain a transformation $T$ that converts every $RGB$ triplet to an $XYZ$ triplet. The transformation when applied to spectral lights will result in the following system of equations.</p>
        <p>
        $
        \begin{bmatrix}
        X_{380} & \cdots & X_{500} & \cdots & X_{780} \\
        Y_{380} & \cdots & Y_{500} & \cdots & Y_{780} \\
        Z_{380} & \cdots & Z_{500} & \cdots & Z_{780} 
        \end{bmatrix} =
        \begin{bmatrix}
        T_{00} & T_{01} & T_{02} \\
        T_{10} & T_{11} & T_{12} \\
        T_{20} & T_{21} & T_{22}
        \end{bmatrix} \times
        \begin{bmatrix}
        R_{380} & \cdots & R_{500} & \cdots & R_{780} \\
        G_{380} & \cdots & G_{500} & \cdots & G_{780} \\
        B_{380} & \cdots & B_{500} & \cdots & B_{780} 
        \end{bmatrix},
        $
        </p>
        <p>You will see that this transformation essentially transforms the RGB CMFs to the XYZ CMFs. There are nine unknowns in matrix $T$. We will need to somehow come up with nine equations to solve for them. The nine equations are obtained through various requirements that we impose on the transformation. We will dissect the requirements step by step.</p>
        <h4>Step 1: From 9 Unknowns to 6 Unknowns</h4>
        <p>The first requirement is that the transformed Y values should exactly match the <a href="https://en.wikipedia.org/wiki/Luminous_efficiency_function">photopic luminous efficiency function</a> $V(\lambda)$ as defined in the CIE 1924 standard. That is:</p>
        <p>
        $
        \begin{bmatrix}
        Y_{380} & \cdots & Y_{500} & \cdots & Y_{780}
        \end{bmatrix} =
        \begin{bmatrix}
        T_{10} & T_{11} & T_{12}
        \end{bmatrix} \times
        \begin{bmatrix}
        R_{380} & \cdots & R_{500} & \cdots & R_{780} \\
        G_{380} & \cdots & G_{500} & \cdots & G_{780} \\
        B_{380} & \cdots & B_{500} & \cdots & B_{780} 
        \end{bmatrix},
        $
        </p>
        <p>Why did CIE 1931 have this requirement? It's merely out of convenience. This is an over-determined system, with 3 unknowns but many more equations. We could estimate a best-fit. But does a best-fit exist? In theory, the transformation here is exact. Since the RGB CMFs are a linear transformation away from the LMS cone fundamentals as discussed in this tutorial, and the luminous efficiency function is, in theory, a linear transformation of the LMS cone fundamentals too. So in theory there will be an exact transformation. In fact, the CIE 1931 RGB CMFs are derived from the CIE 1924 CIE luminous efficiency function (see <a href="http://yuhaozhu.com/blog/cmf.html">discussion here</a>), so $[T_{10}, T_{11}, T_{12}]$ is exactly calculated; $T_{10} = 1.0000, T_{11} = 4.5907, T_{12} = 0.0601]$.</p>
        <h4>Step 2: From 6 Unknowns to 4 Unknowns</h4>
        <p>CIE 1931 also required that the reference white of the XYZ space should be the same as that in the CIE 1931 RGB space (the reference white happens to be Equal-Energy White, but that's irrelevant here). As a result, $[1, 1, 1]$ in the RGB space should be mapped to $[K, K, K]$ in the XYZ space, where $K$ is a constant, indicating that white is represented by equal amount of the XYZ primaries. What this means is that the sums of each row in matrix $T$ should be same, and we know the sum of the second row, because the three elements in the second row are calculated in the previous step already. That is:</p>
        <p>$T_{00} + T_{01} + T_{02} = T_{20} + T_{21} + T_{22} = 1.0000 + 4.5907 + 0.0601 = 5.6508$.</p>
        <p>This allows us to reduce the matrix to just 4 unknowns:</p>
        <p>
        \begin{bmatrix}
        5.6508 - T_{01} - T_{02} && T_{01} && T_{02} \\
        1.0000 && 4.5907 && 0.0601 \\
        5.6508 - T_{21} - T_{22} && T_{21} && T_{22}
        \end{bmatrix}
        </p>
        <h4>Step 3: Solving the 4 Unknowns</h4>
        <p>CIE 1931 also required that, in the chromaticity diagram, the HVS gamut fills the triangle formed by the XYZ primaries as much as possible. This is equivalent to picking a triangle in the rg-chromaticity diagram that just circumscribes the spectral locus. There are many such triangles, and the exact choice is somewhat arbitrary, but in the end, $C_r$ is chosen to be $[1.27, -0.28, 0.01]$, $C_g$ is chosen to be $[-1.74, 2.77, -0.03]$, and $Cb$ is chosen to be $[-0.74, 0.14, 1.60]$. Therefore, we have:</p>
      </div>
    </div>

    <div class="b-example-divider"></div>
  </div>


</main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>

    <script src="xyz.js"></script>
  </body>
</html>
